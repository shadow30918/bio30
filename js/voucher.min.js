function checkData(){if($(".form .ok").hasClass("disabled"))alert("您的資料正在送出, 請勿重覆點擊, 造成資料重覆!");else{var t=1,o="";formInfo.t_name=$.trim($("#name").val()),formInfo.t_mobile=$.trim($("#phone").val()),formInfo.t_email=$.trim($("#email").val()),0==formInfo.t_name.length?(o=checkAlertMsg(o),o+="- 姓名",t=0):ValidateName(formInfo.t_name)||(formInfo.t_name.length<2&&(o=checkAlertMsg(o),o+="- 姓名長度不符合",t=0),isNaN(formInfo.t_name)||(o=checkAlertMsg(o),o+="- 姓名不可含數字",t=0));var e=formInfo.t_mobile.substr(0,2),n=/^[0-9]{2,3}\-[0-9]{5,8}$/,a=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/;if(0==formInfo.t_mobile.length?(o=checkAlertMsg(o),o+="- 手機",t=0):("09"!=e||10!=formInfo.t_mobile.length||n.test(formInfo.t_mobile))&&(o=checkAlertMsg(o),o+="- 手機號碼有誤",t=0),0==formInfo.t_email.length?(o=checkAlertMsg(o),o+="- 電子郵件",t=0):(formInfo.t_email.length<=2||!a.test(formInfo.t_email))&&(o=checkAlertMsg(o),o+="- 電子郵件有誤",t=0),$("#per").is(":checked")||(o=checkAlertMsg(o),o+="- 請同意個資法條款與注意事項",t=0),$("#tips").is(":checked")||(o=checkAlertMsg(o),o+="- 請同意一人限領一次，不可多門號重複領取",t=0),$(".form .ok").removeClass("disabled"),1!=t)return alert("請確認以下欄位:\n\n"+o+"\n\n"),!1;$(".form").hide(),$(".done .name span").empty().append(formInfo.t_name),$(".done .phone span").empty().append(formInfo.t_mobile),$(".done .email span").empty().append(formInfo.t_email),$(".done .shop span").empty().append(selectStoreInfo.s_name),$(".done .address span").empty().append(selectStoreInfo.s_addr),$(".done").show(),$("body,html").animate({scrollTop:$(".done").offset().top},500,"swing")}}function SubmitForm(){$.ajax({url:"func.php",type:"POST",data:{func:"SubmitForm",t_c_no:formInfo.t_c_no,t_s_no:formInfo.t_s_no,t_name:formInfo.t_name,t_mobile:formInfo.t_mobile,t_email:formInfo.t_email},dataType:"json"}).done(function(t){var o=parseInt(t.OK,10);0==o&&(1==t.status&&alert("您的資料中有欄位未填, 請檢查您所填寫的資料!"),2==t.status&&alert("您的資料中有欄位格式不符, 請檢查您所填寫的資料!"),3==t.status&&alert("您的資料中所選擇的櫃點與所在縣市不符, 請檢查您所填寫的資料!"),4==t.status&&alert("您的資料中所選擇的櫃點領取名額己額滿, 請選擇其他領取櫃點!"),5==t.status&&alert("您的手機己參加兌換活動, 且仍在可兌換贈品的時間內, 所以無法重複申請!"),6==t.status&&alert("您己完成己兌換, 所以無法重複申請!"),7==t.status&&alert("您己完成己兌換, 所以無法重複申請!"),8==t.status&&alert("您的Email己參加兌換活動, 且仍在可兌換贈品的時間內, 所以無法重複申請!"),9==t.status&&alert("不明錯誤發生, 請重整網頁重新申請!"),10==t.status&&alert("活動尚未開始, 敬請期待!"),11==t.status&&alert("活動已結束!")),1==o&&("function"==typeof window.adGeekConversion?window.adGeekConversion(function(){GEvent("表單送出"),window.location=siteUrl+"thank.html?t_c_no="+formInfo.t_c_no+"&t_s_no="+formInfo.t_s_no+"&t_no="+t.t_no+"&t_sn_no="+t.t_sn_no+"&token="+t.token}):(GEvent("表單送出"),window.location=siteUrl+"thank.html?t_c_no="+formInfo.t_c_no+"&t_s_no="+formInfo.t_s_no+"&t_no="+t.t_no+"&t_sn_no="+t.t_sn_no+"&token="+t.token))})}function updateRWDImg(){$("img").each(function(t){var o=$(this).attr("src").replace("-dt.",".").split(".");1==$(this).attr("md")&&($(this).attr("src",o[0]+"-dt."+o[1]),isMobile?$(this).attr("src",o[0]+"."+o[1]):$(this).attr("src",o[0]+"-dt."+o[1])),0==$(this).attr("md")&&(isMobile?$(this).hide():$(this).show())})}function getSize(){windowWidth=$(window).width(),windowHeight=$(window).height(),documentHeight=$(document).height(),isMobile=windowWidth<1081}function slider_init(){$(".bloger_slider").slick({nextArrow:'<i class="icon-right-open-big next"></i>',prevArrow:'<i class="icon-left-open-big prev"></i>',responsive:[{breakpoint:3600,settings:"unslick"},{breakpoint:1081,settings:{arrows:!0,dots:!1}}]})}function GEvent(t){var o=t;console.log(o),gtag("event","event_name",{event_label:t,event_action:t})}function SP_aos_init(){if(isMobile)$(".SP ul .title").attr({"data-aos":"","data-aos-anchor":"","data-aos-anchor-placement":"top-bottom","data-aos-delay":"0"}),$(".SP ul .date").attr({"data-aos":"","data-aos-anchor":"","data-aos-anchor-placement":"top-bottom","data-aos-delay":"0"}),$(".SP ul .txt").attr({"data-aos":"","data-aos-anchor":"","data-aos-anchor-placement":"top-bottom","data-aos-delay":"0"}),$(".SP ul .pic").attr({"data-aos":"","data-aos-anchor":"","data-aos-anchor-placement":"top-bottom","data-aos-delay":"0"});else for($(".SP ul .title").attr({"data-aos":"fade-in","data-aos-anchor":".SP","data-aos-duration":"1000","data-aos-anchor-placement":"center-bottom"}),$(".SP ul .date").attr({"data-aos":"fade-left","data-aos-anchor":".SP","data-aos-duration":"1000","data-aos-anchor-placement":"center-bottom"}),$(".SP ul .txt").attr({"data-aos":"fade-up","data-aos-anchor":".SP","data-aos-duration":"1000","data-aos-anchor-placement":"center-bottom"}),$(".SP ul .pic").attr({"data-aos":"fade-in","data-aos-anchor":".SP","data-aos-duration":"1000","data-aos-anchor-placement":"center-bottom"}),i=1;i<5;i++)$(".story li:nth-child("+(i+1)+")").attr("data-aos-delay",500*i),$(".prize li:nth-child("+i+")").attr("data-aos-delay",500*(i+4))}function CityStoreListByEvent(){$.ajax({url:"func.php",type:"POST",data:{func:"CityStoreListByEvent"},dataType:"json"}).done(function(t){if(1==t.OK){if(storeRows=t.storeRows,0===(isEventEnd=toNumber(t.isEventEnd))){for(var o in t.cityRows)$("#city").append('<option value="'+o+'">'+o+"</option>");for(o in t.cityRows)for(subKey in t.cityRows[o])$("#area").append('<option value="'+t.cityRows[o][subKey]+'" class="'+o+'">'+subKey+"</option>");$("#area").chained("#city"),$("#area").on("change",function(){if($(this).children("option:selected").val().length>0&&(formInfo.t_s_no=0,formInfo.t_c_no=0,selectStoreInfo.c_no=0,selectStoreInfo.s_no=0,$(".choose_ok").addClass("disabled"),$("div.map div.list ul > li input[type=radio]").attr("checked",!1),arrMakers=[],isMobile||builtMap("area"),""!=$(this).val())){_val=$(this).val(),_area=$(this).children("option:selected").text();var t=storeRows.filter(function(t){return t.s_c_no===_val}),o=t.filter(function(t){return t.s_area===_area});$("div.map div.list ul").empty();for(var e=0;e<o.length;e++)showStore(o[e]);isMobile||fitMap(),bindStore(),$(".choose .tips").hide(),$(".choose .map, .choose .choose_ok").show()}})}else $("#city, #area, div.choose > div.tips").on("click",function(){alert("活動已結束!")});$(".find_location").click(function(){1===isEventEnd?alert("活動已結束!"):isMap?($("#LoadingContainer").show(),formInfo.t_s_no=0,formInfo.t_c_no=0,selectStoreInfo.c_no=0,selectStoreInfo.s_no=0,$(".choose_ok").addClass("disabled"),$("div.map div.list ul > li input[type=radio]").attr("checked",!1),arrMakers=[],openSelfGMap(),isMobile||fitMap(),bindStore()):alert("您的瀏覽器不允許地理定位!!")})}})}function getSelfPos(t){window.navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){selfPos=t.coords.latitude+","+t.coords.longitude,$("#LoadingContainer").hide()}):alert("您的瀏覽器不支援地理定位!!")}function initMap(){getSelfPos()}function builtMap(t){clearAllInterval();var o=selfPos.split(",");if(pcMap=new google.maps.Map($("div.google_map_dt")[0],{zoom:16,center:{lat:toNumber(o[0]),lng:toNumber(o[1])},mapTypeId:"roadmap"}),"near"===t){var e=new google.maps.Marker({position:{lat:toNumber(o[0]),lng:toNumber(o[1])},map:pcMap,gestureHandling:"none",zoomControl:!1});arrMakers.push(e)}}function openSelfGMap(){$("div.map div.list ul").empty(),isMobile||builtMap("near");for(var t=0;t<storeRows.length;t++)GetDistance(selfPos,storeRows[t].s_lnl)<=nearbyDistance&&showStore(storeRows[t]);$(".choose .tips").hide(),$(".choose .map, .choose .choose_ok").show()}function showStore(t){if($("div.map div.list ul").append('<li class="no_'+t.s_no+'"></li>'),$("div.map div.list ul li.no_"+t.s_no).append('<input type="radio" name="store" id="store_'+t.s_no+'" value="'+t.s_no+'" no="'+t.s_c_no+'">'),$("div.map div.list ul li.no_"+t.s_no).append('<label for="store_'+t.s_no+'"></label>'),$("div.map div.list ul li.no_"+t.s_no+" label").append("<span></span>"),$("div.map div.list ul li.no_"+t.s_no+" label").append('<div class="name">'+t.s_name+"</div>"),$("div.map div.list ul li.no_"+t.s_no+" label").append('<div class="phone">'+t.s_tel+"</div>"),$("div.map div.list ul li.no_"+t.s_no+" label").append('<div class="address">'+t.s_addr+"</div>"),$("div.map div.list ul li.no_"+t.s_no).append('<div class="google_map_mb" id="mapFrame_'+t.s_no+'"></div>'),isMobile)$("div.map div.list ul li.no_"+t.s_no+" div.google_map_mb").append('<img src="//maps.googleapis.com/maps/api/staticmap?center='+t.s_lnl+"&zoom=14&size=512x256&maptype=roadmap&markers=icon:"+siteUrl+"img/map_1.ico|"+t.s_lnl+"&key="+googleMapKey+'">');else{var o=t.s_lnl.split(","),e=new google.maps.Marker({map:pcMap,draggable:!1,animation:google.maps.Animation.DROP,icon:siteUrl+"img/map_1.png",position:{lat:toNumber(o[0]),lng:toNumber(o[1])}});e.s_no=t.s_no,arrMakers.push(e)}}function bindStore(){$("div.map div.list ul > li").on("click",function(t){if($(".choose_ok").removeClass("disabled"),formInfo.t_s_no!==$(this).children("input").val()&&(formInfo.t_s_no=$(this).children("input").val(),formInfo.t_c_no=$(this).children("input").attr("no"),selectStoreInfo.c_no=$(this).children("input").attr("no"),selectStoreInfo.s_no=$(this).children("input").val(),selectStoreInfo.s_name=$(this).children("label").children(".name").text(),selectStoreInfo.s_tel=$(this).children("label").children(".phone").text(),selectStoreInfo.s_addr=$(this).children("label").children(".address").text(),!isMobile))for(var o=0;o<arrMakers.length;o++){var e=arrMakers[o];if(clearAllInterval(),e.setAnimation(null),arrMakers[o].s_no===selectStoreInfo.s_no){var n=e;n.setIcon(siteUrl+"img/map_2.png"),setTimeout(function(){bounceMarker(n)},100)}else arrMakers[o].s_no>0&&e.setIcon(siteUrl+"img/map_1.png")}}),$("#LoadingContainer").hide()}function clearAllInterval(){clearInterval(timerInterval)}function bounceMarker(t){t.setAnimation(google.maps.Animation.BOUNCE),console.log("*"+t.s_no),timerInterval=setInterval(function(){console.log(t.s_no),t.setAnimation(google.maps.Animation.BOUNCE)},1e3)}function fitMap(){var t=new google.maps.LatLngBounds;if(arrMakers.length>0){for(var o=0;o<arrMakers.length;o++)t.extend(arrMakers[o].getPosition()),google.maps.event.addListener(arrMakers[o],"mouseover",function(){this.setIcon(siteUrl+"img/map_2.png")}),google.maps.event.addListener(arrMakers[o],"mouseout",function(){this.setIcon(siteUrl+"img/map_1.png")});pcMap.fitBounds(t),google.maps.event.addListenerOnce(pcMap,"bounds_changed",function(){this.getZoom()>16&&this.setZoom(16)})}}function GetDistance(t,o){var e=t.split(",");lat1=e[0],lng1=e[1],e=o.split(","),lat2=e[0],lng2=e[1];var n=rad(lat1),a=rad(lat2),i=n-a,s=rad(lng1)-rad(lng2),r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(i/2),2)+Math.cos(n)*Math.cos(a)*Math.pow(Math.sin(s/2),2)));return r*=EARTH_RADIUS,r=Math.round(1e4*r)/1e4}function rad(t){return t*Math.PI/180}function toNumber(t){return+t}function checkAlertMsg(t){return t.length>0&&(t+="\n"),t}function ValidateName(t){return!!/^[\u4e00-\u9fa5a-zA-Z]{2,20}$/.test(t)}var isMobile=!1,storeRows=null,EARTH_RADIUS=6378.137,nearbyDistance=3,siteUrl="https://www.beauty-event.com.tw/bio30th/",redirectPage="voucher.html",googleMapKey="AIzaSyBvnmWhTYMl3HDLiIxNzXkQ39ZfJT9Snho",pcMap,selfPos,arrMakers=[],timerInterval,formInfo={t_c_no:0,t_s_no:0,t_name:"",t_mobile:"",t_email:""},selectStoreInfo={c_no:0,s_no:0,s_name:"",s_tel:"",s_addr:""},isMap=!0,isEventEnd=0;$(document).ready(function(){setTimeout(function(){isMap||(console.log("***map"),$("#LoadingContainer").hide())},3e3),getSize(),updateRWDImg(),SP_aos_init(),CityStoreListByEvent(),isMobile?($(".menuWrap").css("display","none"),$(".beauty").addClass("active")):($(".menuWrap").css("display","block"),$(".beauty").removeClass("active"),$(".bgV").append('<video src="img/bio30th/30THBB-540P.mp4" preload autoplay loop muted></video>')),$(window).on("resize",function(){getSize(),updateRWDImg(),setTimeout(slider_init,300),SP_aos_init(),$(".bgV video").remove(),isMobile?($(".menuWrap").css("display","none"),$(".menuWrap").removeClass("active"),$(".beauty").addClass("active")):($(".menuWrap").css("display","block"),$(".beauty").removeClass("active"),$(".bgV").append('<video src="img/bio30th/30THBB-540P.mp4" preload autoplay loop muted></video>'))}),$(".menu_ham").click(function(){$(".menuWrap").hasClass("active")||($(".menuWrap").addClass("active"),$(".menuWrap").slideDown(600))}),$(".close").click(function(){$(".menuWrap").removeClass("active"),$(".menuWrap").slideUp(600)}),$(document).on("mouseover",".over",function(){var t=$(this).children("img").attr("src").replace("-dt.","_act-dt.");$(this).children("img").attr("src",t)}),$(document).on("mouseout",".over",function(){var t=$(this).children("img").attr("src").replace("_act-dt.","-dt.");$(this).children("img").attr("src",t)}),$(".beauty").click(function(){GEvent("menu_gotoIndex"),window.open("index.html","_self")}),$(".menu .photowall").click(function(){GEvent("menu_gotoPhotowall"),window.open("photowall.html","_self")}),$(".play").click(function(){GEvent("開啟影片_voucher"),$(".yt_popup").append('<iframe src="https://www.youtube.com/embed/prbUWmQBTx0?rel=0&amp;showinfo=0&amp;autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>').fadeIn(500)}),$(".yt_popup").click(function(){$(this).fadeOut(500,function(){$(this).children("iframe").remove()})});var t=["http://weiisly.pixnet.net/blog/post/66715392-女孩的夢幻保養品-資生堂百優精純乳霜","http://clinaliu.pixnet.net/blog/post/348147577","http://www.poppyoh.com/?p=8323"];$(".blog .group").click(function(){index=isMobile?$(this).index()-1:$(this).index(),0!==t[index].length?(window.open(t[index],"_blank"),GEvent("voucher_bloger_"+(index+1))):alert("coming soon!")}),$(".choose_ok").click(function(){0===formInfo.t_s_no?alert("請選擇一個領取的櫃點!"):($("div.form ul.shop li.name span").empty().append(selectStoreInfo.s_name),$("div.form ul.shop li.info span.phone").empty().append(selectStoreInfo.s_tel),$("div.form ul.shop li.info span.address").empty().append(selectStoreInfo.s_addr),$(".choose").hide(),$(".form").show(),$("body,html").animate({scrollTop:$(".form").offset().top},500,"swing"))}),$(".check li>span").click(function(){window.open("http://www.shiseido.com.tw/terms.aspx#/policy","_blank")}),$(".form .back").click(function(){$(".form").hide(),$(".choose").show(),$("body,html").animate({scrollTop:$(".choose").offset().top},500,"swing")}),$(".form .ok").click(function(){checkData()}),$(".done .back").click(function(){$(".done").hide(),$(".form").show(),$("body,html").animate({scrollTop:$(".form").offset().top},500,"swing")}),$(".done .submit").click(function(){SubmitForm()})}),$(window).load(function(){AOS.init({duration:1500,easing:"ease-out"}),slider_init()});